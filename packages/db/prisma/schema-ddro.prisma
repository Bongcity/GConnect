// ============================================
// DDRo 외부 데이터베이스 스키마 (기준 DB)
// ============================================
// 서버: 59.23.231.197,14103
// DB: DDRo
// 용도: 네이버 스마트스토어 GLOBAL 상품 데이터
// ⚠️  이 DB는 수정 금지! 읽기 전용으로만 사용

generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/@prisma-ddro/client"
}

datasource db {
  provider = "sqlserver"
  url      = env("DDRO_DATABASE_URL")
}

// ============================================
// 상품 테이블 (GLOBAL 상품 - 기준)
// ============================================

/// 네이버 스마트스토어 제휴 상품 (DDRo 기준)
/// ⚠️ DDRo에서는 id에 IDENTITY가 없음 (수동 관리)
model AffiliateProduct {
  id                            BigInt    @id
  
  // 제휴 상점 정보
  affiliate_store_id            BigInt?
  store_name                    String?   @db.NVarChar(200)
  brand_store                   Boolean?
  store_status                  String?   @db.NVarChar(50)
  
  // 상품 기본 정보
  product_name                  String?   @db.NVarChar(500)
  product_status                String?   @db.NVarChar(50)
  
  // 가격 정보
  sale_price                    BigInt?
  discounted_sale_price         BigInt?
  discounted_rate               Float?
  
  // 수수료 정보
  commission_rate               Float?
  promotion_commission_rate     Float?
  
  // 이미지 정보
  representative_product_image_url  String?   @db.NVarChar(1000)
  other_product_image_urls      String?   @db.NVarChar(Max)
  
  // URL 정보
  product_url                   String?   @db.NVarChar(1000)
  product_description_url       String?   @db.NVarChar(1000)
  affiliate_url                 String?   @db.NVarChar(1000)
  affiliate_url_id              BigInt?
  affiliate_url_updated_at      DateTime?
  
  // 프로모션 정보 (JSON)
  promotion_json                String?   @db.NVarChar(Max)
  
  // 상태
  enabled                       Boolean?
  
  // 수집 메타 정보
  source_keyword                String?   @db.NVarChar(200)
  source_cid                    String?   @db.NVarChar(50)
  source_rank                   Int?
  google_in                     Int?
  
  // 타임스탬프
  created_at                    DateTime? @default(now())
  updated_at                    DateTime? @default(now())
  
  @@map("affiliate_products")
  @@index([source_cid])
  @@index([source_keyword])
  @@index([created_at])
}

// ============================================
// 카테고리 관련 테이블
// ============================================

/// 네이버 카테고리 정보
model NaverCategory {
  id                BigInt    @id @default(autoincrement())
  category_1        String?   @db.NVarChar(100)
  category_2        String?   @db.NVarChar(100)
  category_3        String?   @db.NVarChar(100)
  cid               String?   @db.NVarChar(50)
  created_at        DateTime? @default(now())
  
  @@map("NaverCategories")
  @@index([cid])
}

/// 네이버 수집 진행 상태
model NaverCollectionProgress {
  id                BigInt    @id @default(autoincrement())
  cid               String?   @db.NVarChar(50)
  category_1        String?   @db.NVarChar(100)
  category_2        String?   @db.NVarChar(100)
  category_3        String?   @db.NVarChar(100)
  collection_type   String?   @db.NVarChar(20)
  status            String?   @db.NVarChar(20)
  started_at        DateTime?
  completed_at      DateTime?
  error_message     String?   @db.NVarChar(500)
  retry_count       Int?      @default(0)
  created_at        DateTime? @default(now())
  updated_at        DateTime? @default(now())
  
  @@map("NaverCollectionProgress")
}

/// 네이버 쇼핑 키워드
model NaverShoppingKeyword {
  id                BigInt    @id @default(autoincrement())
  category_1        String?   @db.NVarChar(100)
  category_2        String?   @db.NVarChar(100)
  category_3        String?   @db.NVarChar(100)
  cid               String?   @db.NVarChar(50)
  rank              Int?
  keyword           String?   @db.NVarChar(200)
  collected_date    DateTime? @db.Date
  start_date        DateTime? @db.Date
  end_date          DateTime? @db.Date
  status            String?   @default("completed") @db.NVarChar(20)
  updated_at        DateTime? @default(now())
  brandlistin       Int?
  brandlitin        Int?
  
  @@map("NaverShoppingKeywords")
  @@index([cid])
  @@index([keyword])
}
